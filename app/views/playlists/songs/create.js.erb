(function() {
  var playlistElement = App.playlistElement('<%= @playlist.id %>')

  <% if @playlist.songs.size > 1 %>
    var infiniteScrollElement = document.querySelector("#js-playlist-content [data-controller='infinite-scroll']");
    var hasNoNextUrl = infiniteScrollElement && !infiniteScrollElement.dataset.infiniteScrollNextUrl

    if (playlistElement && hasNoNextUrl) {
      App.dispatchEvent(playlistElement, 'playlistSongs:updateCount', '<%= @playlist.songs.size %>');
      document.querySelector('#js-playlist-list-content').insertAdjacentHTML('beforeend', "<%= j(render partial: 'playlists/song', collection: @songs, cached: true)%>");
    }
  <% else %>
    if (playlistElement) {
      App.renderPlaylistContent("<%= j @playlist.buildin? ? render('playlists/show_buildin') : render('playlists/show') %>")
    }
  <% end %>
})();

<%= render_flash %>
